const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CharacterDetailModal-DwdzNZzN.js","./index-BrxcLGeD.js","./index-CQ3EfDEq.css","./RelationshipResultView-Dqa_LGhW.js","./x-BVOO3rRw.js","./zap-DVssP9Ig.js","./check-DawilqLo.js","./share-2-D_yvVxY1.js","./RadarChart-ClWn9KuN.js","./palette-C6nRAHMr.js","./users-Cir3es1S.js","./save-63v6V0ng.js"])))=>i.map(i=>d[i]);
import{c as B,r as s,j as e,A as Nt,e as st,S as rt,a as kt,b as je,_ as Ct,f as Xe,P as Me,D as St,L as Ye,T as nt,d as A,g as zt,s as be,B as $t,h as _t,i as Dt}from"./index-BrxcLGeD.js";import{U as Mt,M as Tt}from"./MessageModal-BF3EKuuJ.js";import{C as we,F as It,P as Lt,a as Et}from"./CharacterDetailModal-DwdzNZzN.js";import{C as ve}from"./circle-alert-BoEv356N.js";import{C as Rt,S as Te,H as Ot,a as lt,b as Ht}from"./RelationshipResultView-Dqa_LGhW.js";import{A as At}from"./arrow-right-B5W3ZTPT.js";import{R as Bt,a as Vt,P as Ft,b as Pt,c as qt,T as Ut}from"./RadarChart-ClWn9KuN.js";import{Z as Kt}from"./zap-DVssP9Ig.js";import{X as me}from"./x-BVOO3rRw.js";import{S as Wt}from"./save-63v6V0ng.js";import{U as et}from"./users-Cir3es1S.js";import"./share-2-D_yvVxY1.js";import"./check-DawilqLo.js";import"./palette-C6nRAHMr.js";/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]],it=B("arrow-down-wide-narrow",Jt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["path",{d:"M2 13a2 2 0 0 0 2-2V7a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0V4a2 2 0 0 1 4 0v13a2 2 0 0 0 4 0v-4a2 2 0 0 1 2-2",key:"57tc96"}]],Qt=B("audio-waveform",Gt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Xt=B("book",Zt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ie=B("calendar",Yt);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],ta=B("chart-line",ea);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Le=B("file-text",aa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ra=B("image",sa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["rect",{width:"7",height:"18",x:"3",y:"3",rx:"1",key:"2obqm"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}]],la=B("layout-panel-left",na);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],ca=B("maximize",ia);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M14 14a2 2 0 0 0 2-2V8h-2",key:"1r06pg"}],["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M8 14a2 2 0 0 0 2-2V8H8",key:"1jzu5j"}]],da=B("message-square-quote",oa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ct=B("message-square",xa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M5 12h14",key:"1ays0h"}]],pa=B("minus",ma);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ha=B("pen",ua);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],Ee=B("quote",fa);/**
 * @license lucide-react v0.559.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],ga=B("sliders-horizontal",ya),ba=s.lazy(()=>Ct(()=>import("./CharacterDetailModal-DwdzNZzN.js").then(a=>a.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),ae=a=>typeof a=="string"?a:a&&typeof a=="object"?a.bestMatch&&a.why?`${a.bestMatch}

${a.why}`:JSON.stringify(a,null,2).replace(/\\n/g,`
`):String(a||""),De=({text:a,label:y,icon:p,colorClass:b="text-[var(--accent-primary)]",contentSize:j="text-[11px] md:text-[12px]",isItalic:_=!1,frontIcon:v=null})=>{const[w,g]=s.useState(!1),[f,N]=s.useState(!1),D=s.useRef(null);return s.useLayoutEffect(()=>{if(D.current&&!w){const h=D.current.scrollHeight>D.current.clientHeight;N(h)}},[a,w]),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:`text-[9px] md:text-[10px] font-black ${b} opacity-40 uppercase tracking-widest flex items-center gap-1.5`,style:{color:"var(--text-primary)"},children:[p," ",y]}),e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>f&&g(!w),children:[e.jsxs("p",{ref:D,className:`${j} leading-relaxed whitespace-pre-wrap font-medium transition-all duration-300 ${w?"":"line-clamp-3"} ${_?"italic":""}`,style:{color:"var(--text-primary)"},children:[v&&e.jsx("span",{className:"inline-block mr-1.5 opacity-60 mb-0.5",children:v}),a]}),f&&e.jsx("div",{className:"mt-1 text-[9px] md:text-[10px] font-black text-[var(--accent-primary)] hover:underline flex items-center gap-1",children:w?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:10})," 접기"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{size:10})," ",y," 더 보기"]})})]})]})},va=({logs:a,knownProfiles:y,onUpdateProfile:p,onNavigateToAnalysis:b,focusTarget:j,currentCategoryId:_})=>{var re,G,P,K,ee,W,te,Q,Z;const[v,w]=s.useState(""),[g,f]=s.useState(null),[N,D]=s.useState("latest"),h=s.useRef({}),[L,E]=s.useState(!0),k=s.useRef(0),c=s.useCallback(n=>{const x=n.currentTarget.scrollTop;Math.abs(x-k.current)<=40||(x>k.current&&x>80?E(!1):E(!0),k.current=x)},[]),F=s.useMemo(()=>{try{const n=new Set;return a.forEach(x=>{var o,i;(i=(o=x.analysis)==null?void 0:o.characterReactions)==null||i.forEach(u=>{if(u!=null&&u.name){const z=y.find(d=>String(d.name)===String(u.name)||d.aliases&&d.aliases.some($=>String($).toLowerCase()===String(u.name).toLowerCase()));n.add(z?z.name:String(u.name))}})}),Array.from(n).sort()}catch{return[]}},[a,y]);s.useEffect(()=>{if(j!=null&&j.charName){const n=ae(j.charName),x=y.find(i=>String(i.name)===n||i.aliases&&i.aliases.some(u=>String(u).toLowerCase()===n.toLowerCase())),o=x?x.name:n;w(o)}},[F,j,y]),s.useEffect(()=>{if(j&&v){const n=h.current[j.logId];if(n){const x=setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("ring-4","ring-[var(--accent-50)]"),setTimeout(()=>n.classList.remove("ring-4","ring-[var(--accent-50)]"),3e3)},500);return()=>clearTimeout(x)}}},[v,j]);const C=s.useMemo(()=>{if(!v)return[];const n=y.find(o=>o.name===v),x=n?[n.name,...n.aliases||[]]:[v];return a.filter(o=>{var i,u;return(u=(i=o.analysis)==null?void 0:i.characterReactions)==null?void 0:u.some(z=>x.includes(String(z.name)))}).map(o=>{var u,z;const i=(z=(u=o.analysis)==null?void 0:u.characterReactions)==null?void 0:z.find(d=>x.includes(String(d.name)));return{...o,reaction:i,emotions:i==null?void 0:i.emotions,emotionText:(i==null?void 0:i.emotion)||"-",innerThought:ae(i==null?void 0:i.innerThought)||"-",stress:(i==null?void 0:i.stressLevel)||0}}).sort((o,i)=>{if(N==="latest"){const u=new Date(`${o.date}T${o.time||"00:00"}`).getTime(),z=new Date(`${i.date}T${i.time||"00:00"}`).getTime();return z!==u?z-u:(i.timestamp||0)-(o.timestamp||0)}else return(i.timestamp||0)-(o.timestamp||0)})},[a,v,N,y]),q=s.useMemo(()=>{if(C.length===0)return[];const n=C.reduce((o,i)=>{var u,z,d,$,M;return o.joy+=((u=i.emotions)==null?void 0:u.joy)||0,o.anger+=((z=i.emotions)==null?void 0:z.anger)||0,o.sadness+=((d=i.emotions)==null?void 0:d.sadness)||0,o.fear+=(($=i.emotions)==null?void 0:$.fear)||0,o.trust+=((M=i.emotions)==null?void 0:M.trust)||0,o},{joy:0,anger:0,sadness:0,fear:0,trust:0}),x=C.length;return[{subject:"기쁨",A:n.joy/x},{subject:"분노",A:n.anger/x},{subject:"슬픔",A:n.sadness/x},{subject:"두려움",A:n.fear/x},{subject:"신뢰",A:n.trust/x}]},[C]),H=s.useMemo(()=>{if(!q.length)return"var(--accent-primary)";const x=[...q].sort((o,i)=>i.A-o.A)[0];return x.subject==="기쁨"?"#fbbf24":x.subject==="분노"?"#f43f5e":x.subject==="슬픔"?"#60a5fa":x.subject==="두려움"?"#a855f7":x.subject==="신뢰"?"#10b981":"var(--accent-primary)"},[q]),S=y.find(n=>n.name===v),U=n=>n==="joy"?"bg-amber-400":n==="anger"?"bg-rose-500":n==="sadness"?"bg-blue-400":n==="fear"?"bg-purple-500":n==="trust"?"bg-emerald-500":"bg-[var(--accent-primary)]",se=n=>({joy:"기쁨",anger:"분노",sadness:"슬픔",fear:"두려움",trust:"신뢰"})[n]||n,Y=n=>{var x;return n&&((x=Object.entries(n).sort(([,o],[,i])=>Number(i)-Number(o))[0])==null?void 0:x[0])||"trust"};return F.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 opacity-30 italic font-black gap-4",style:{color:"var(--text-primary)"},children:[e.jsx(ve,{size:64}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"textxl",children:"아직 분석된 데이터가 없습니다."}),e.jsx("p",{className:"text-sm mt-2 font-bold",children:"서사를 등록하고 분석을 시작해 보세요."})]})]}):_==="all"?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center animate-fade-in p-8",children:e.jsxs("div",{className:"glass-panel p-12 rounded-[2.5rem] border bg-[var(--accent-10)] flex flex-col items-center justify-center gap-4 text-center max-w-2xl mx-auto relative z-10",style:{borderColor:"var(--glass-border)"},children:[e.jsx(ve,{size:48,className:"text-[var(--accent-primary)] opacity-40"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-black",style:{color:"var(--text-primary)"},children:"서사 카테고리를 선택하세요"}),e.jsx("p",{className:"text-sm opacity-50",style:{color:"var(--text-primary)"},children:"캐릭터별 상세 분석은 개별 카테고리 화면에서만 가능합니다."})]})]})}):e.jsxs("div",{className:"space-y-0 animate-fade-in w-full h-full flex flex-col min-h-0 relative",children:[e.jsx("div",{className:`p-3 md:p-4 glass-panel rounded-xl border border-white/10 shrink-0 mb-4 transition-all duration-300 overflow-hidden relative z-10 ${L?"max-h-24 opacity-100":"max-h-0 opacity-0 py-0 mb-0 border-0"}`,children:e.jsxs("div",{className:"flex flex-row items-center justify-center gap-3",children:[e.jsx("span",{className:"text-[9px] md:text-[10px] font-black opacity-40 uppercase tracking-widest whitespace-nowrap",style:{color:"var(--text-primary)"},children:"캐릭터 선택"}),e.jsxs("select",{value:v,onChange:n=>w(n.target.value),className:"bg-transparent text-[var(--text-primary)] border border-white/10 rounded-lg px-2 md:px-4 py-1.5 md:py-2 text-[11px] font-bold outline-none focus:ring-1 focus:ring-[var(--accent-primary)] w-auto min-w-[120px]",children:[" ",e.jsx("option",{value:"",disabled:!0,className:"bg-white text-slate-900",children:"캐릭터 선택"},""),F.map(n=>e.jsx("option",{value:n,className:"bg-white text-slate-900",children:n},n))]})]})}),v?e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-1 space-y-6 md:space-y-10 pb-20 relative z-10",onScroll:c,children:[e.jsxs("div",{className:"glass-panel p-5 md:p-8 rounded-2xl md:rounded-3xl border border-white/10 flex flex-col md:flex-row items-center gap-5 md:gap-8 relative shrink-0 overflow-hidden",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full overflow-hidden border-2 border-white/10 flex items-center justify-center relative bg-black/5 cursor-pointer z-10 shrink-0",onClick:()=>S&&f(S),children:S!=null&&S.thumbnailUrl||S!=null&&S.imageUrl?e.jsx("img",{src:S.thumbnailUrl||S.imageUrl,alt:v,className:"w-full h-full object-cover"}):e.jsx(Rt,{size:40,className:"opacity-50 text-white"})}),e.jsxs("div",{className:"text-center md:text-left flex-1 min-w-0 z-10 flex-col md:flex-row items-center justify-between gap-3 flex",children:[e.jsxs("div",{className:"space-y-2 md:space-y-3 w-full",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-black cursor-pointer hover:text-[var(--accent-primary)] transition-colors inline-flex items-center gap-2 max-w-full",style:{color:"var(--text-primary)"},onClick:()=>{S?f(S):b==null||b(v)},children:[ae(v)," ",e.jsx(At,{size:16,className:"opacity-30 shrink-0"})]}),S?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex wrap items-center gap-1.5 justify-center md:justify-start",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded-md text-[8px] md:text-[9px] font-black text-[var(--accent-primary)] flex items-center gap-1 border-none outline-none",style:{backgroundColor:"var(--accent-10)"},children:(G=(re=S.analysisData)==null?void 0:re.mbti)==null?void 0:G.type}),e.jsx("span",{className:"px-1.5 py-0.5 bg-purple-500/10 rounded-md text-[8px] md:text-[9px] font-black text-purple-400 flex items-center gap-1 border-none outline-none",children:(K=(P=S.analysisData)==null?void 0:P.enneagram)==null?void 0:K.type}),e.jsx("span",{className:"px-1.5 py-0.5 bg-pink-500/10 rounded-md text-[8px] md:text-[9px] font-black text-pink-400 flex items-center gap-1 border-none outline-none",children:Nt[(W=(ee=S.analysisData)==null?void 0:ee.archetype)==null?void 0:W.name]||((Q=(te=S.analysisData)==null?void 0:te.archetype)==null?void 0:Q.name)})]}),e.jsxs("p",{className:"text-[11px] md:text-sm opacity-70 font-bold italic line-clamp-2 md:line-clamp-none",style:{color:"var(--text-primary)"},children:['"',ae((Z=S.analysisData)==null?void 0:Z.oneLineSummary)||"",'"']})]}):e.jsxs("div",{className:"p-3 md:p-5 rounded-xl md:rounded-[2rem] bg-amber-500/10 border border-amber-500/30 flex items-center gap-3 md:gap-5 shadow-sm",children:[e.jsx(ve,{size:16,className:"text-amber-500 shrink-0 animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("p",{className:"text-[9px] font-black text-amber-500 uppercase tracking-widest",children:"미분석"}),e.jsx("p",{className:"text-[10px] font-bold",style:{color:"var(--text-primary)"},children:"프로필 분석이 필요합니다. 이미 등록된 캐릭터일 경우 카테고리를 지정하세요."})]}),e.jsx("button",{onClick:()=>b==null?void 0:b(v),className:"px-3 md:px-5 py-1.5 md:py-2 bg-amber-500 rounded-lg md:rounded-xl text-black font-black text-[9px] md:text-[10px] hover:bg-amber-400 transition-all shrink-0",children:"분석"})]})]}),e.jsxs("div",{className:"flex flex-col items-center shrink-0",children:[e.jsx("p",{className:"text-[9px] font-black opacity-40 uppercase tracking-widest mb-1",style:{color:"var(--text-primary)"},children:"평균 감정 분포"}),e.jsx("div",{className:"w-24 h-24 md:w-28 md:h-28 opacity-90",children:e.jsx(Bt,{width:"100%",height:"100%",children:e.jsxs(Vt,{cx:"50%",cy:"50%",outerRadius:"60%",data:q,children:[e.jsx(Ft,{stroke:"var(--accent-10)"}),e.jsx(Pt,{dataKey:"subject",tick:{fill:"var(--text-primary)",fontSize:8}}),e.jsx(qt,{name:"값",dataKey:"A",stroke:H,fill:H,fillOpacity:.4}),e.jsx(Ut,{contentStyle:{backgroundColor:"rgba(0,0,0,0.8)",border:"none",color:"white",fontSize:8}})]})})})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3 shrink-0",children:[e.jsxs("h3",{className:"text-[10px] md:text-[11px] font-black flex items-center gap-2 uppercase tracking-[0.2em] text-[var(--accent-primary)] pl-1",children:[e.jsx(Ie,{size:13})," 서사 타임라인"]}),e.jsx("div",{className:"max-h-[220px] md:max-h-[300px] overflow-y-auto custom-scrollbar space-y-2 pr-1",children:C.map(n=>{var x,o,i;return e.jsxs("div",{onClick:()=>{const u=h.current[n.id];u==null||u.scrollIntoView({behavior:"smooth",block:"center"})},className:"glass-panel p-2.5 md:p-3.5 rounded-xl md:rounded-2xl border border-white/5 hover:border-[var(--accent-40)] hover:bg-white/5 transition-all cursor-pointer group flex items-center justify-between gap-4 bg-black/10",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"text-[8px] md:text-[9px] font-black opacity-30 shrink-0",style:{color:"var(--text-primary)"},children:n.date}),e.jsxs("div",{className:"flex items-center gap-1 text-[8px] md:text-[9px] font-black text-[var(--accent-primary)] opacity-60 shrink-0 uppercase",children:[e.jsx(Te,{size:9,fill:"currentColor"})," ",((x=n.analysis)==null?void 0:x.score)||0,"점"]}),e.jsx("div",{className:"hidden md:block text-[10px] md:text-[11px] font-bold opacity-80 truncate",style:{color:"var(--text-primary)"},children:(o=n.analysis)==null?void 0:o.summary})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"flex wrap gap-1",children:((i=n.analysis)==null?void 0:i.keywords)&&n.analysis.keywords.slice(0,2).map((u,z)=>e.jsxs("span",{className:"text-[7px] md:text-[8px] font-black text-[var(--accent-primary)] border-none px-1 py-0.5 rounded",style:{backgroundColor:"var(--accent-10)"},children:["#",ae(u)]},z))}),e.jsxs("div",{className:"flex items-center gap-1 text-[8px] md:text-[9px] font-black text-rose-400 opacity-60 uppercase shrink-0",children:[e.jsx(Kt,{size:9})," ",n.stress,"%"]}),e.jsx(st,{size:12,className:"opacity-0 group-hover:opacity-100 transition-all text-[var(--accent-primary)]"})]})]},n.id)})})]}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex justify-between items-end pl-1",children:[e.jsxs("h3",{className:"text-[10px] md:text-[11px] font-black flex items-center gap-2 uppercase tracking-[0.1em] text-violet-400",children:[e.jsx(Qt,{size:13})," 감정 로그"]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1.5 bg-black/5 rounded-xl border border-white/5 shadow-inner",children:[e.jsx(it,{size:12,className:"opacity-40"}),e.jsxs("select",{value:N,onChange:n=>D(n.target.value),className:"bg-transparent text-[var(--text-primary)] border-none px-2 py-0.5 rounded-lg text-[10px] font-black outline-none cursor-pointer",children:[e.jsx("option",{value:"latest",className:"bg-white text-slate-900",children:"날짜순"}),e.jsx("option",{value:"oldest",className:"bg-white text-slate-900",children:"등록순"})]})]})]})}),e.jsx("div",{className:"grid gap-3 w-full",children:C.map(n=>{var o;const x=Y(n.emotions);return e.jsxs("div",{id:`log-detail-${n.id}`,ref:i=>{h.current[n.id]=i},className:"p-4 md:p-5 rounded-[1.5rem] md:rounded-[2.5rem] border-l-4 md:border-l-8 glass-panel shadow-xl flex flex-col gap-4 md:gap-6 bg-white/5 scroll-mt-10 md:scroll-mt-20",style:{borderLeftColor:"var(--accent-primary)"},children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-white/5 pb-2",children:[e.jsxs("span",{className:"text-[10px] font-black opacity-40",style:{color:"var(--text-primary)"},children:[n.date," ",n.time]}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-6",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:`flex items-center gap-1 px-2 rounded-full border border-white/10 ${U(x)}`,title:`스트레스 : ${n.stress}%`,children:e.jsx("span",{className:"text-[11px] font-black text-white",children:n.emotionText})})}),e.jsx("div",{className:"flex flex-col items-end gap-1.5",children:e.jsx("div",{className:"flex gap-1 pr-1 md:pr-2",children:n.emotions&&Object.entries(n.emotions).map(([i,u])=>e.jsxs("div",{className:"group/bar relative w-1.5 md:w-2.5 h-3 md:h-4 bg-slate-700/20 rounded-sm border border-white/5 cursor-help",children:[e.jsx("div",{className:`absolute bottom-0 w-full transition-all duration-700 rounded-sm ${U(i)}`,style:{height:`${Number(u)*10}%`}}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-1.5 hidden group-hover/bar:block bg-black/90 text-white text-[7px] md:text-[8px] font-black px-2 py-1 rounded-md shadow-2xl z-[60] whitespace-nowrap border border-white/10 scale-110",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${U(i)}`}),se(i),": ",u,"/10"]})})]},i))})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 md:gap-3",children:[e.jsx(da,{className:"text-violet-500 shrink-0 mt-1",size:14}),e.jsxs("div",{className:"flex-1 space-y-2 overflow-hidden",children:[e.jsx(De,{text:ae(n.innerThought),label:"속마음",icon:e.jsx(Ot,{size:10}),colorClass:"text-violet-400",contentSize:"text-[12px] md:text-[14px]",isItalic:!0,frontIcon:e.jsx(Ee,{size:10,className:"inline-block mr-1.5 opacity-40 rotate-180"})}),e.jsxs("div",{className:"p-4 md:p-6 rounded-2xl md:rounded-[2rem] bg-black/5 border border-white/5 space-y-3 md:space-y-4",children:[e.jsx(De,{text:ae((o=n.analysis)==null?void 0:o.summary),label:"분석 요약",icon:e.jsx(rt,{size:10}),colorClass:"text-[var(--accent-primary)]"}),e.jsx("div",{className:"border-t border-white/5 pt-3",children:e.jsx(De,{text:ae(n.content),label:"서사 원문",icon:e.jsx(kt,{size:10}),colorClass:"text-slate-400"})})]})]})]})]},n.id)})})]}):e.jsx("div",{className:"text-center py-24 opacity-30 italic font-bold text-white",children:"캐릭터를 선택해 주세요."}),g&&e.jsx(s.Suspense,{fallback:null,children:e.jsx(ba,{character:g,isOpen:!!g,onClose:()=>f(null),onSave:async n=>{await(p==null?void 0:p(n)),f(null)},onDelete:()=>f(null),onGoToAnalysis:b})})]})},ja=({isSidebarCollapsed:a,setIsSidebarCollapsed:y,selectedCatId:p,setSelectedCatId:b,categories:j,visibleCategories:_,ddays:v,onAddCategory:w,onRenameCategory:g,onDeleteCategory:f,onReorderCategories:N,onAddDDay:D,onDeleteDDay:h,onBackup:L,onRestore:E,getOffsetNow:k,isAddingDDay:c,setIsAddingDDay:F,isMobileUI:C})=>{const[q,H]=s.useState(!1),[S,U]=s.useState(!1),[se,Y]=s.useState(""),[re,G]=s.useState(null),[P,K]=s.useState(""),[ee,W]=s.useState(null),[te,Q]=s.useState(null),[Z,n]=s.useState(""),[x,o]=s.useState(()=>new Date().toISOString().split("T")[0]),i=(d,$)=>{W($),d.dataTransfer.effectAllowed="move"},u=(d,$)=>{if(d.preventDefault(),ee===null||ee===$)return;const M=[..._],[pe]=M.splice(ee,1);M.splice($,0,pe),N(M),W(null),Q(null)},z=s.useMemo(()=>{try{const d=getComputedStyle(document.documentElement).getPropertyValue("--glass-bg").trim();return d.includes("rgba(0, 0, 0")||d.includes("rgba(15, 23, 42")?"#ffffff":"var(--accent-primary)"}catch{return"var(--accent-primary)"}},[]);return e.jsxs("aside",{className:`glass-panel border-r flex flex-col h-full shadow-2xl backdrop-blur-xl z-[70] shrink-0 transition-all duration-300 ease-in-out fixed inset-y-0 left-0 ${C?"":"lg:static"} ${a?`-translate-x-full ${C?"":"lg:translate-x-0 lg:w-20"} opacity-0 ${C?"":"lg:opacity-100"} overflow-hidden`:"translate-x-0 w-64 lg:w-72 opacity-100"}`,style:{borderColor:"var(--glass-border)"},children:[e.jsxs("div",{className:`p-6 border-b shrink-0 flex items-center ${a?"justify-center":"justify-between"}`,style:{borderColor:"var(--glass-border)"},children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(It,{size:18,className:"shrink-0",style:{color:"var(--accent-primary)",fill:"var(--accent-primary)"}}),!a&&e.jsx("h2",{className:"text-sm font-black uppercase tracking-widest truncate",style:{color:"var(--text-primary)"},children:"서사 아카이브"})]}),!a&&e.jsx("button",{onClick:()=>y(!0),className:`${C?"":"lg:hidden"} ml-auto p-2 text-white/50`,children:e.jsx(Xe,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-6 flex flex-col",children:[e.jsxs("div",{className:"space-y-1 p-2",children:[e.jsxs("div",{className:`flex items-center mb-2 ${a?"justify-center":"justify-between px-2"}`,children:[!a&&e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest opacity-40",style:{color:"var(--text-primary)"},children:"카테고리"}),!a&&e.jsx("button",{onClick:()=>H(!q),className:"p-1 hover:bg-white/5 rounded-md transition-colors opacity-40 hover:opacity-100",style:{color:"var(--text-primary)"},children:q?e.jsx(je,{size:14}):e.jsx(we,{size:14})})]}),!q&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>{b("all"),(C||window.innerWidth<640)&&y(!0)},className:`w-full text-left px-2 py-3 rounded-xl transition-all text-xs font-black flex items-center gap-3 ${a?"justify-center":"justify-start lg:px-4"} ${p==="all"?"shadow-lg":"opacity-60 hover:opacity-100 hover:bg-white/5"}`,style:{backgroundColor:p==="all"?"var(--accent-primary)":"transparent",color:p==="all"?"var(--accent-text)":"var(--text-primary)"},children:[e.jsx(Le,{size:14,className:"shrink-0"})," ",!a&&e.jsx("span",{className:"truncate",children:"전체 기록"})]}),e.jsxs("div",{className:`${a?"":"pl-2 border-l border-white/10"} space-y-1 mt-1`,children:[_.map((d,$)=>e.jsxs("div",{className:`group relative transition-all ${te===$?"border-t-2 border-[var(--accent-primary)] pt-2":""}`,draggable:!a,onDragStart:M=>i(M,$),onDragOver:M=>{M.preventDefault(),Q($)},onDrop:M=>u(M,$),children:[e.jsx("div",{className:`flex items-center rounded-xl transition-all ${p===d.id?"bg-transparent":"hover:bg-white/5"}`,children:re===d.id&&!a?e.jsx("div",{className:"flex-1 p-1",children:e.jsx("input",{autoFocus:!0,value:P,onChange:M=>K(M.target.value),onBlur:()=>{g(d.id,P),G(null)},onKeyDown:M=>M.key==="Enter"&&(g(d.id,P),G(null)),className:"w-full bg-black/40 border border-[var(--accent-primary)] rounded-lg px-2 py-1 text-[11px] text-white outline-none"})}):e.jsxs("button",{onClick:()=>{b(d.id),(C||window.innerWidth<640)&&y(!0)},className:`flex-1 text-left py-2.5 transition-all text-[11px] font-bold flex items-center gap-3 ${a?"justify-center":"justify-start px-2 lg:px-4"} ${p===d.id?"":"opacity-50 hover:opacity-100"}`,style:{color:"var(--text-primary)"},children:[e.jsx(pa,{size:12,className:`shrink-0 ${p===d.id?"text-[var(--accent-primary)]":"opacity-40"}`}),!a&&e.jsx("span",{className:"truncate pr-1",children:d.name})]})}),!a&&e.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-900/80 rounded-lg p-1",children:[e.jsx("button",{onClick:M=>{M.stopPropagation(),G(d.id),K(d.name)},className:"p-1 text-white/30 hover:text-[var(--accent-primary)]",children:e.jsx(ha,{size:12})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),f(d.id)},className:"p-1 text-white/30 hover:text-rose-400",children:e.jsx(me,{size:12})})]})]},d.id)),!a&&(S?e.jsx("div",{className:"px-1 py-1",children:e.jsx("input",{autoFocus:!0,value:se,onChange:d=>Y(d.target.value),onBlur:()=>{w(se),Y(""),U(!1)},onKeyDown:d=>d.key==="Enter"&&(w(se),Y(""),U(!1)),placeholder:"이름...",className:"bg-black/40 border border-white/10 rounded-lg px-2 py-1.5 text-[10px] text-white outline-none w-full"})}):e.jsxs("button",{onClick:()=>U(!0),className:"w-full text-left px-2 lg:px-4 py-2 rounded-xl opacity-30 hover:opacity-100 hover:bg-white/5 transition-all text-[11px] font-bold flex items-center justify-start gap-3",style:{color:"var(--text-primary)"},children:[e.jsx(Me,{size:12,className:"shrink-0"})," ",e.jsx("span",{className:"truncate",children:"추가"})]}))]})]})]}),e.jsx("div",{className:"flex-1"}),!a&&e.jsxs("div",{className:"space-y-3 pb-0 border-t border-white/5 pt-4 px-2 lg:px-4",children:[e.jsxs("div",{className:"flex items-center opacity-50 justify-between px-2",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest truncate",style:{color:"var(--text-primary)"},children:"기념일 / 디데이"}),e.jsx("button",{onClick:()=>F(!c),className:"hover:text-amber-400 transition-colors shrink-0",style:{color:"var(--text-primary)"},children:e.jsx(Me,{size:14})})]}),c&&e.jsxs("div",{className:"p-2 lg:p-3 rounded-2xl bg-[var(--accent-10)] border border-[var(--accent-20)] space-y-2",children:[e.jsx("input",{type:"date",value:x,onChange:d=>o(d.target.value),className:"w-full bg-black/20 border-none rounded-lg px-2 py-1 text-[10px] text-white outline-none"}),e.jsx("input",{type:"text",value:Z,onChange:d=>n(d.target.value),placeholder:"사건명...",className:"w-full bg-black/20 border-none rounded-lg px-2 py-1 text-[10px] text-white outline-none"}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsx("button",{onClick:()=>F(!1),className:"flex-1 py-1 text-[9px] font-black opacity-50 text-white",children:"취소"}),e.jsx("button",{onClick:()=>{D(Z,x),n(""),F(!1)},className:"flex-1 py-1 bg-[var(--accent-primary)] rounded-lg text-[9px] font-black text-[var(--accent-text)]",children:"등록"})]})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:v.map(d=>{const $=Math.ceil((new Date(d.targetDate).getTime()-k().getTime())/864e5);return e.jsxs("div",{className:"p-2 rounded-xl bg-black/10 group relative transition-all hover:bg-black/20 flex flex-col items-start lg:p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1.5 w-full",children:[e.jsxs("div",{className:"text-[8px] md:text-[9px] font-black opacity-40 flex items-center gap-1 overflow-hidden",style:{color:"var(--text-primary)"},children:[e.jsx(lt,{size:10,className:"shrink-0"})," ",e.jsx("span",{className:"truncate",children:d.targetDate})]}),e.jsx("div",{className:`text-[9px] md:text-[10px] font-black shrink-0 ${$<0?"text-rose-500":$===0?"text-[var(--accent-primary)]":"text-amber-500"}`,children:$===0?"D-Day":$<0?`+${Math.abs($)}`:`-${$}`})]}),e.jsx("div",{className:"text-[10px] md:text-[11px] font-bold leading-snug break-words pr-4 w-full",style:{color:"var(--text-primary)"},children:d.title}),e.jsx("button",{onClick:()=>h(d.id),className:"absolute top-1 right-1 p-1 opacity-0 group-hover:opacity-40 hover:opacity-100 hover:text-rose-500 transition-all",children:e.jsx(me,{size:10})})]},d.id)})})]}),e.jsxs("div",{className:`p-1 border-t shrink-0 flex flex-row gap-2 ${a?"items-center justify-center p-2":"p-4"}`,style:{borderColor:"var(--glass-border)"},children:[e.jsxs("button",{onClick:L,className:"flex items-center gap-2 py-2 rounded-xl bg-[var(--accent-10)] hover:bg-[var(--accent-10)] transition-colors text-[9px] font-black opacity-60 hover:opacity-100",style:{color:"var(--text-primary)",width:a?"auto":"100%",justifyContent:a?"center":"start",padding:a?"0.5rem":"0.5rem 1rem"},children:[e.jsx(St,{size:14,className:"shrink-0"}),!a&&e.jsx("span",{className:"truncate",children:"서사 백업"})]}),e.jsxs("label",{className:"flex items-center gap-2 py-2 rounded-xl bg-[var(--accent-10)] hover:bg-[var(--accent-10)] transition-colors text-[9px] font-black opacity-60 hover:opacity-100 cursor-pointer",style:{color:"var(--text-primary)",width:a?"auto":"100%",justifyContent:a?"center":"start",padding:a?"0.5rem":"0.5rem 1rem"},children:[e.jsx(Mt,{size:14,className:"shrink-0"}),!a&&e.jsx("span",{className:"truncate",children:"서사 복원"}),e.jsx("input",{type:"file",className:"hidden",onChange:E,accept:".json"})]})]})]}),e.jsx("div",{className:"p-4 border-t shrink-0 flex justify-center",style:{borderColor:"var(--glass-border)"},children:e.jsx("button",{onClick:()=>y(!a),className:"p-3 hover:scale-110 transition-transform",style:{color:z,fill:z},children:a?e.jsx(st,{size:24}):e.jsx(Xe,{size:24})})})]})},wa=({isInputFormOpen:a,editingLogId:y,inputText:p,setInputText:b,inputDate:j,setInputDate:_,inputTime:v,setInputTime:w,selectedProfileIds:g,setSelectedProfileIds:f,availableCharacters:N,onSave:D,isLoading:h,onCancel:L,textareaRef:E})=>a?e.jsxs("div",{className:"glass-panel p-6 md:p-8 rounded-[2rem] md:rounded-[2.5rem] border bg-transparent shadow-xl animate-fade-in-up",style:{borderColor:"var(--glass-border)"},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-white/5 pb-4",children:[e.jsxs("h3",{className:"text-sm font-black text-[var(--accent-primary)] flex items-center gap-2 uppercase tracking-widest",children:[e.jsx(Xt,{size:16})," 서사 작성"]}),e.jsx("button",{onClick:L,className:"p-2 hover:bg-white/5 rounded-full transition-colors opacity-40 hover:opacity-100",children:e.jsx(me,{size:20})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[e.jsxs("div",{className:"w-full md:w-56 space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-black opacity-30 uppercase ml-1",style:{color:"var(--text-primary)"},children:"날짜 및 시간"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"relative group overflow-hidden rounded-xl border border-white/10 bg-[var(--accent-10)] focus-within:ring-2 focus-within:ring-[var(--accent-50)] transition-all",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[var(--accent-primary)] opacity-60 pointer-events-none",children:e.jsx(Ie,{size:14})}),e.jsx("input",{type:"date",value:j,onChange:k=>_(k.target.value),className:"w-full bg-transparent pl-9 pr-4 py-2.5 text-[11px] font-bold outline-none cursor-pointer",style:{color:"var(--text-primary)"}})]}),e.jsxs("div",{className:"relative group overflow-hidden rounded-xl border border-white/10 bg-[var(--accent-10)] focus-within:ring-2 focus-within:ring-[var(--accent-50)] transition-all",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[var(--accent-primary)] opacity-60 pointer-events-none",children:e.jsx(lt,{size:14})}),e.jsx("input",{type:"time",value:v,onChange:k=>w(k.target.value),className:"w-full bg-transparent pl-9 pr-4 py-2.5 text-[11px] font-bold outline-none cursor-pointer",style:{color:"var(--text-primary)"}})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-black opacity-30 uppercase ml-1",style:{color:"var(--text-primary)"},children:"등장인물"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 max-h-32 overflow-y-auto custom-scrollbar p-1.5 bg-transparent rounded-xl border border-white/5",children:N.map(k=>e.jsx("button",{onClick:()=>f(c=>c.includes(k.id)?c.filter(F=>F!==k.id):[...c,k.id]),className:`px-2 py-1 rounded-lg text-[9px] font-black transition-all border ${g.includes(k.id)?"shadow-md scale-[1.02]":"opacity-40 hover:bg-black/5"}`,style:{backgroundColor:g.includes(k.id)?"var(--accent-primary)":"var(--accent-10)",borderColor:g.includes(k.id)?"transparent":"var(--glass-border)",color:g.includes(k.id)?"var(--accent-text)":"var(--text-primary)"},children:k.name},k.id))})]})]}),e.jsxs("div",{className:"flex-1 w-full space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-[9px] font-black opacity-30 uppercase",style:{color:"var(--text-primary)"},children:"내용 (최대 2000자)"}),e.jsxs("span",{className:`text-[9px] font-black ${p.length>2e3?"text-rose-500":"opacity-30"}`,children:[p.length," / 2000"]})]}),e.jsx("textarea",{ref:E,value:p,onChange:k=>b(k.target.value),placeholder:"어떤 일이 일어났나요? 혹은 어떤 대화가 오갔나요?...",className:"w-full h-40 bg-transparent border rounded-2xl p-5 text-sm outline-none resize-none leading-relaxed focus:ring-1 focus:ring-[var(--accent-primary)] placeholder:opacity-30 custom-scrollbar shadow-inner",style:{borderColor:"var(--glass-border)",color:"var(--text-primary)"}})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[e.jsxs("button",{onClick:()=>D(!1),disabled:h||!p.trim()||p.length>2e3,className:"flex-1 py-3 bg-[var(--accent-10)] hover:bg-[var(--accent-20)] transition-all text-[var(--accent-primary)] font-black rounded-xl flex items-center justify-center gap-2 text-xs cursor-pointer border-none outline-none",children:[h?e.jsx(Ye,{size:14,className:"animate-spin"}):e.jsx(Wt,{size:14})," ",y?"수정":"기록 저장"]}),e.jsxs("button",{onClick:()=>D(!0),disabled:h||!p.trim()||p.length>2e3,className:"flex-[2] py-3 bg-[var(--btn-bg)] transition-colors hover:bg-[var(--accent-50)] transition-all text-white font-black rounded-xl flex items-center justify-center gap-2 shadow-lg text-xs cursor-pointer",style:{color:"var(--accent-text)","--btn-bg":"var(--accent-primary)"},children:[h?e.jsx(Ye,{size:14,className:"animate-spin"}):e.jsx(rt,{size:14})," ",y?"재분석":"서사 분석"]})]})]})]})]}):null,le=a=>typeof a=="string"||typeof a=="number"?String(a):a&&typeof a=="object"?a.bestMatch&&a.why?`${a.bestMatch}

${a.why}`:JSON.stringify(a).replace(/\\n/g,`
`):String(a||""),tt=({text:a,label:y,icon:p,colorClass:b="text-[var(--accent-primary)]",labelSize:j="text-[9px]",contentSize:_="text-[13px]",isItalic:v=!1,showQuote:w=!1})=>{const[g,f]=s.useState(!1),[N,D]=s.useState(!1),h=s.useRef(null);return s.useLayoutEffect(()=>{if(h.current&&!g){const L=h.current.scrollHeight>h.current.clientHeight;D(L)}},[a,g]),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:`${j} font-black ${b} opacity-60 uppercase tracking-widest flex items-center gap-1.5`,children:[p," ",y]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:h,className:`
        ${_} leading-relaxed whitespace-pre-wrap transition-all duration-300 
        ${g?"":"line-clamp-3"} 
        ${v?"italic opacity-90":""}
        ${w?"pl-4 -indent-4":""} // ✅ showQuote가 있을 때만 들여쓰기 적용
    `,style:{color:"var(--text-primary)"},children:typeof a=="string"?a.split(`
`).map((L,E)=>e.jsxs("p",{className:`${w?"mb-1":""}`,children:[E===0&&w&&e.jsx(Ee,{size:14,className:"inline-block mr-1 opacity-40 rotate-180 mb-0.5"}),L]},E)):a}),N&&e.jsx("button",{onClick:()=>f(!g),className:"mt-1 text-[10px] font-black text-[var(--accent-40)] hover:underline flex items-center gap-1",children:g?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:12})," 접기"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{size:12})," ",y," 더 보기"]})})]})]})},Na=(a,y)=>{const p=String(a||"").replace(/[\[\]]/g,"").trim().toLowerCase();return y.find(b=>{var j;return String(b.name||"").trim().toLowerCase()===p||((j=b.aliases)==null?void 0:j.some(_=>String(_||"").trim().toLowerCase()===p))})},ka=({log:a,categories:y,savedCharacters:p,onEdit:b,onDelete:j,onChangeCategory:_,onCharacterClick:v})=>{var w,g;return e.jsxs("div",{id:`log-${a.id}`,className:"glass-panel p-6 md:p-8 rounded-[2rem] md:rounded-[2.5rem] border bg-white/[0.08] group hover:border-[var(--accent-primary)] transition-all shadow-lg",style:{borderColor:"var(--glass-border)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-4 relative z-10",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[11px] font-black opacity-80",style:{color:"var(--text-primary)"},children:[a.date," ",a.time&&e.jsx("span",{className:"opacity-40 ml-1",children:a.time})]}),e.jsx("select",{value:a.categoryId,onChange:f=>_(a.id,f.target.value),className:"bg-transparent text-[var(--accent-primary)] border-none px-2 py-0.5 rounded-lg text-[10px] font-black outline-none cursor-pointer",children:y.map(f=>e.jsx("option",{value:f.id,className:"bg-white text-slate-900",children:f.name},f.id))})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[(a.characters||[]).map(f=>{var h,L;const N=(L=(h=a.analysis)==null?void 0:h.characterReactions)==null?void 0:L.find(E=>{var k;return String(E.name).trim().toLowerCase()===String(f.name).trim().toLowerCase()||((k=Na(String(E.name),p))==null?void 0:k.name)===f.name}),D=N==null?void 0:N.stressLevel;return e.jsxs("button",{title:"속마음 확인하기",onClick:()=>v(f.name,a.id),className:"px-2 py-1 rounded-lg border-none text-[10px] font-black text-[var(--accent-primary)] hover:bg-[var(--accent-20)] transition-all flex items-center gap-1",style:{backgroundColor:"var(--accent-10)"},children:[le(f.name).replace(/[\[\]]/g,""),D!==void 0&&e.jsxs("span",{className:`flex items-center gap-0.5 ml-1 border-l border-white/10 pl-2 ${parseInt(String(D))>=70?"text-rose-400":parseInt(String(D))>=40?"text-amber-400":"text-emerald-400"}`,children:["stress ",le(D),"%"]})]},f.name)}),e.jsx("div",{className:"pl-3",children:(g=(w=a.analysis)==null?void 0:w.keywords)==null?void 0:g.map((f,N)=>e.jsxs("span",{className:"text-[10px] font-black",style:{marginRight:"10px",color:"var(--accent-50)"},children:["#",le(f)]},N))})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[a.analysis&&e.jsx("div",{className:"flex items-center gap-1.5 bg-transparent px-3 py-1 rounded-full border border-transparent",title:le(a.analysis.emotionalTone),children:e.jsx("span",{className:"text-base font-black md:text-[28px] text-[20px]",style:{color:"var(--accent-primary)"},children:le(a.analysis.score)})}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>b(a),className:"p-2 text-[var(--text-primary)] hover:bg-[var(--accent-10)] rounded-lg transition-all",title:"수정",children:e.jsx(Lt,{size:14})}),e.jsx("button",{onClick:()=>j(a.id),className:"p-2 text-rose-500 hover:bg-rose-500/10 rounded-lg transition-all",title:"삭제",children:e.jsx(nt,{size:14})})]})]})]}),e.jsxs("div",{className:"space-y-6 mt-4 relative z-10",children:[e.jsx(tt,{text:le(a.content),label:"서사 원문",icon:e.jsx(Le,{size:10}),colorClass:"text-[var(--text-primary)]",labelSize:"text-[11px]",contentSize:"text-[15px] pl-2 indent-1",isItalic:!0}),a.analysis&&e.jsxs("div",{className:"md:p-6 p-4 pb-2 bg-black/10 rounded-[1.5rem] md:rounded-[2rem] border border-white/5 shadow-inner",style:{borderColor:"var(--glass-border)"},children:[e.jsx(tt,{text:le(a.analysis.summary),label:"AI 요약",icon:e.jsx(ct,{size:10}),colorClass:"text-[var(--accent-primary)]",labelSize:"text-[11px]",contentSize:"text-[13px]",showQuote:!0}),e.jsx("div",{className:"text-right w-full",children:e.jsx("span",{className:"inline-block py-3 my-1 text-[9px] font-black opacity-50",style:{color:"var(--text-primary)"},children:"클릭하여 속마음 확인하기"})})]})]})]})},Ca=(a,y)=>{const p=String(a||"").replace(/[\[\]]/g,"").trim().toLowerCase();return y.find(b=>{var j;return String(b.name||"").trim().toLowerCase()===p||((j=b.aliases)==null?void 0:j.some(_=>String(_||"").trim().toLowerCase()===p))})},X=a=>typeof a=="string"||typeof a=="number"?String(a):a&&typeof a=="object"?a.bestMatch&&a.why?`${a.bestMatch}

${a.why}`:JSON.stringify(a).replace(/\\n/g,`
`):String(a||""),at=({text:a,label:y,icon:p,colorClass:b="text-[var(--accent-primary)]",labelSize:j="text-[9px]",contentSize:_="text-[13px]",isItalic:v=!1,showQuote:w=!1})=>{const[g,f]=s.useState(!1),[N,D]=s.useState(!1),h=s.useRef(null);return s.useLayoutEffect(()=>{if(h.current&&!g){const L=h.current.scrollHeight>h.current.clientHeight;D(L)}},[a,g]),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:`${j} font-black ${b} opacity-60 uppercase tracking-widest flex items-center gap-1.5`,children:[p," ",y]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:h,className:`
        ${_} leading-relaxed whitespace-pre-wrap transition-all duration-300 
        ${g?"":"line-clamp-3"} 
        ${v?"italic opacity-90":""}
        ${w?"pl-4 -indent-4":""} // ✅ showQuote가 있을 때만 들여쓰기 적용
    `,style:{color:"var(--text-primary)"},children:typeof a=="string"?a.split(`
`).map((L,E)=>e.jsxs("p",{className:`${w?"mb-1":""}`,children:[E===0&&w&&e.jsx(Ee,{size:14,className:"inline-block mr-1 opacity-40 rotate-180 mb-0.5"}),L]},E)):a}),N&&e.jsx("button",{onClick:()=>f(!g),className:"mt-1 text-[10px] font-black text-[var(--accent-40)] hover:underline flex items-center gap-1",children:g?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:12})," 접기"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{size:12})," ",y," 더 보기"]})})]})]})},Ba=({apiKey:a,provider:y,savedCharacters:p,onUpdateProfile:b,onNavigateToCharacter:j,timezoneOffset:_,isSidebarCollapsed:v,setIsSidebarCollapsed:w,isMainSidebarOpen:g,isMobileUI:f})=>{var Je,Ge,Qe,Ze;const[N,D]=s.useState([]),[h,L]=s.useState([]),[E,k]=s.useState([]),[c,F]=s.useState(()=>{try{return localStorage.getItem("hpersona_selected_cat")||"all"}catch{return"all"}}),[C,q]=s.useState("history"),[H,S]=s.useState(null),[U,se]=s.useState(()=>{try{return localStorage.getItem("hpersona_log_sort_order")||"latest"}catch{return"latest"}}),[Y,re]=s.useState(!1),[G,P]=s.useState(""),K=s.useCallback(()=>{const t=new Date,l=t.getTime()+t.getTimezoneOffset()*6e4,r=new Date(l+36e5*_);return{date:r.toISOString().split("T")[0],time:r.toTimeString().slice(0,5)}},[_]),ee=()=>{const t=new Date,l=t.getTime()+t.getTimezoneOffset()*6e4;return new Date(l+36e5*_)},[W,te]=s.useState(()=>K().date),[Q,Z]=s.useState(()=>K().time),[n,x]=s.useState([]),[o,i]=s.useState(null),[u,z]=s.useState(!1),[d,$]=s.useState(!1),[M,pe]=s.useState(null),[Ne,ke]=s.useState(null),[ie,Re]=s.useState({isOpen:!1,type:"info",title:"",message:"",onConfirm:()=>{}}),ce=(t,l,r,m,I)=>{Re({isOpen:!0,type:t,title:l,message:r,onConfirm:m,defaultValue:I})},ne=()=>Re(t=>({...t,isOpen:!1})),ot=s.useRef(null),oe=s.useRef(null),Ce=s.useRef(null),[dt,Oe]=s.useState(!0),Se=s.useRef(0),[He,ue]=s.useState(""),[Ae,he]=s.useState(""),[Be,Ve]=s.useState({pos:"50% 0%",scale:100,opacity:20}),[Fe,Pe]=s.useState({pos:"50% 0%",scale:100,opacity:20}),qe=s.useRef(null),[ze,$e]=s.useState(!1);s.useEffect(()=>{if(c!=="all"){ue(localStorage.getItem(`hpersona_bg_history_${c}`)||""),he(localStorage.getItem(`hpersona_bg_trends_${c}`)||"");const t=localStorage.getItem(`hpersona_bg_history_pos_${c}`)||"50% 0%",l=parseInt(localStorage.getItem(`hpersona_bg_history_scale_${c}`)||"100"),r=parseInt(localStorage.getItem(`hpersona_bg_history_opacity_${c}`)||"20");Ve({pos:t,scale:l,opacity:r});const m=localStorage.getItem(`hpersona_bg_trends_pos_${c}`)||"50% 0%",I=parseInt(localStorage.getItem(`hpersona_bg_trends_scale_${c}`)||"100"),O=parseInt(localStorage.getItem(`hpersona_bg_trends_opacity_${c}`)||"20");Pe({pos:m,scale:I,opacity:O})}else ue(""),he("")},[c]);const xt=(t,l)=>{var I;const r=(I=t.target.files)==null?void 0:I[0];if(!r||c==="all")return;const m=new FileReader;m.onload=O=>{var T;const R=(T=O.target)==null?void 0:T.result;l==="history"?(ue(R),localStorage.setItem(`hpersona_bg_history_${c}`,R)):(he(R),localStorage.setItem(`hpersona_bg_trends_${c}`,R))},m.readAsDataURL(r),t.target.value=""},mt=t=>{t==="history"?(ue(""),localStorage.removeItem(`hpersona_bg_history_${c}`)):(he(""),localStorage.removeItem(`hpersona_bg_trends_${c}`))},fe=(t,l,r)=>{t==="history"?(Ve(m=>({...m,[l]:r})),localStorage.setItem(`hpersona_bg_history_${l}_${c}`,r.toString())):(Pe(m=>({...m,[l]:r})),localStorage.setItem(`hpersona_bg_trends_${l}_${c}`,r.toString()))},_e=s.useCallback(()=>{if(!oe.current)return;const t=oe.current.scrollTop;Math.abs(t-Se.current)<=50||(t>Se.current&&t>100?Oe(!1):Oe(!0),Se.current=t)},[]);s.useEffect(()=>{const t=oe.current;if(t)return t.addEventListener("scroll",_e),()=>t.removeEventListener("scroll",_e)},[_e]);const J=s.useCallback(async()=>{try{const[t,l,r]=await Promise.all([A.loadLogs(),A.loadNarrativeCategories(),A.loadDDays()]);D(t||[]),L(l||[]),k(r||[])}catch(t){console.error("데이터 로드 오류:",t)}},[]);s.useEffect(()=>{J()},[J]),s.useEffect(()=>{if(u&&!o){const{date:t,time:l}=K();te(t),Z(l)}},[u,o,K]),s.useEffect(()=>{try{localStorage.setItem("hpersona_selected_cat",c)}catch{}o&&(i(null),P(""),x([]),z(!1))},[c]);const de=s.useMemo(()=>[...c==="all"?N:N.filter(l=>l.categoryId===c)].sort((l,r)=>{if(U==="latest"){const m=new Date(`${l.date}T${l.time||"00:00"}`).getTime(),I=new Date(`${r.date}T${r.time||"00:00"}`).getTime();return I!==m?I-m:(r.timestamp||0)-(l.timestamp||0)}else return(r.timestamp||0)-(l.timestamp||0)}),[N,c,U]),pt=s.useMemo(()=>[...de].sort((t,l)=>{const r=new Date(`${t.date}T${t.time||"00:00"}`).getTime(),m=new Date(`${l.date}T${l.time||"00:00"}`).getTime();return r!==m?r-m:(t.timestamp||0)-(l.timestamp||0)}),[de]),ut=s.useMemo(()=>h.filter(t=>t.id!=="default"),[h]),Ue=s.useMemo(()=>c==="all"?p:p.filter(t=>t.category===c||!t.category&&c==="default"),[p,c]),ht=async t=>{const l=be(G);if(!(!l||l.length>2e3)&&c!=="all"){re(!0);try{const r=o?N.find(R=>R.id===o):null;let m=(r==null?void 0:r.analysis)||null;if(t){const R=p.filter(V=>n.includes(V.id)),T=R.map(V=>V.name),ye=new Date(`${W}T${Q}`).getTime(),ge=N.filter(V=>V.categoryId===c).filter(V=>new Date(`${V.date}T${V.time||"00:00"}`).getTime()<ye).filter(V=>{var xe;return(xe=V.characters)==null?void 0:xe.some(wt=>T.includes(wt.name))}).sort((V,xe)=>new Date(`${V.date}T${V.time||"00:00"}`).getTime()-new Date(`${xe.date}T${xe.time||"00:00"}`).getTime()).slice(-15);m=await _t(l,W,y,a,R,ge)}const I=((m==null?void 0:m.characterReactions)||[]).map(R=>{var ye,ge;const T=Ca(R.name,p);return T?{name:T.name,mbti:((ge=(ye=T.analysisData)==null?void 0:ye.mbti)==null?void 0:ge.type)||"Unknown"}:{name:X(R.name).replace(/[\[\]]/g,""),mbti:"Unknown"}}).filter(R=>R.name!=="Unknown"),O={id:o||crypto.randomUUID(),categoryId:c,date:W,time:Q,content:l,analysis:m,characters:I,timestamp:r?r.timestamp:Date.now()};await A.saveLog(O),await J(),P(""),x([]),i(null),z(!1)}catch(r){ce("error","처리 실패",r.message,ne)}finally{re(!1)}}},ft=async(t,l)=>{const r=be(l);r&&(await A.renameNarrativeCategory(t,r),await J())},yt=t=>{ce("confirm","카테고리 삭제","정말 삭제하시겠습니까?",async()=>{const l=h.filter(r=>r.id!==t);await A.saveNarrativeCategories(l),await J(),c===t&&F("all"),ne()})},Ke=(t,l)=>{S(null),pe({charName:X(t).replace(/[\[\]]/g,""),logId:l}),q("analysis")},gt=t=>{i(t.id),P(X(t.content)),te(t.date),Z(t.time||"12:00"),x(p.filter(l=>{var r;return(r=t.characters)==null?void 0:r.some(m=>m.name.trim().toLowerCase()===l.name.trim().toLowerCase())}).map(l=>l.id)),z(!0),oe.current&&oe.current.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{var l;return(l=Ce.current)==null?void 0:l.focus()},100)},bt=t=>{ce("confirm","기록 삭제","정말 삭제하시겠습니까?",async()=>{await A.deleteLog(t),await J(),ne()})},vt=s.useMemo(()=>{try{const t=getComputedStyle(document.documentElement).getPropertyValue("--glass-bg").trim();return t.includes("rgba(0, 0, 0")||t.includes("rgba(15, 23, 42")?"#ffffff":"var(--accent-primary)"}catch{return"var(--text-primary)"}},[]),We=({type:t})=>{const l=t==="history"?He:Ae,r=t==="history"?Be:Fe;if(c==="all"||!l)return null;const m=C==="history";return e.jsx("div",{className:`absolute z-0 transition-opacity opacity-100 pointer-events-none 
          ${m?"-top-4 md:-top-8 -left-4 md:-left-8 -right-4 md:-right-8 bottom-0":"inset-0"}`,style:{minHeight:"100%"},children:e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("img",{src:l,alt:"Background",draggable:!1,className:"w-full h-full object-cover transition-transform duration-300 select-none",style:{objectPosition:r.pos,opacity:r.opacity/100,transform:`scale(${r.scale/100})`}}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2",style:{background:"linear-gradient(to bottom, transparent 0%, var(--bg-from) 100%)"}})]})})},jt=()=>{if(c==="all"||!ze||C==="analysis")return null;const t=C==="trends"?"trends":"history",l=t==="history"?He:Ae,r=t==="history"?Be:Fe,[m,I]=s.useState(r.scale),[O,R]=s.useState(r.opacity);return s.useEffect(()=>{I(r.scale),R(r.opacity)},[r.scale,r.opacity]),e.jsx("div",{className:"absolute top-16 right-4 z-[200] animate-bounce-in",children:e.jsxs("div",{className:"bg-controls-panel flex flex-col gap-1.5 p-2.5 rounded-[1.5rem] glass-panel shadow-2xl border border-white/20 backdrop-blur-3xl w-40 overflow-hidden opacity-70",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Dt,{size:12,className:"text-[var(--accent-primary)]"})," ",e.jsx("span",{className:"text-[8px] font-black uppercase tracking-tighter",children:"배경 설정"})]}),e.jsx("button",{onClick:()=>$e(!1),className:"p-1 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(me,{size:12})})]}),e.jsx("button",{onClick:()=>{var T;return(T=qe.current)==null?void 0:T.click()},className:"w-full py-1.5 rounded-lg bg-[var(--accent-primary)] text-[var(--accent-text)] font-black text-[8px] flex items-center justify-center gap-1 shadow-lg active:scale-95 transition-all",children:l?"변경":"추가"}),e.jsx("input",{type:"file",ref:qe,className:"hidden",accept:"image/*",onChange:T=>xt(T,t)}),l&&e.jsxs("div",{className:"space-y-3 mt-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[7px] font-black opacity-60 px-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ca,{size:9})," 크기"]}),e.jsxs("span",{children:[m,"%"]})]}),e.jsx("input",{type:"range",min:"100",max:"300",value:m,onChange:T=>I(parseInt(T.target.value)),onMouseUp:()=>fe(t,"scale",m),onTouchEnd:()=>fe(t,"scale",m),onMouseDown:T=>T.stopPropagation(),className:"w-full h-1 bg-white/10 rounded-full appearance-none cursor-pointer accent-[var(--accent-primary)] [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white"})]}),e.jsxs("div",{className:"space-y-1 mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-[7px] font-black opacity-60 px-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ga,{size:9})," 투명도"]}),e.jsxs("span",{children:[O,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:O,onChange:T=>R(parseInt(T.target.value)),onMouseUp:()=>fe(t,"opacity",O),onTouchEnd:()=>fe(t,"opacity",O),onMouseDown:T=>T.stopPropagation(),className:"w-full h-1 bg-white/10 rounded-full appearance-none cursor-pointer accent-[var(--accent-primary)] [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white"})]}),e.jsxs("button",{onClick:()=>mt(t),className:"w-full py-1 rounded-lg bg-rose-500/10 text-rose-400 font-black text-[8px] flex items-center justify-center gap-1 hover:bg-rose-500/20 transition-all",children:[e.jsx(nt,{size:10})," 제거"]})]})]})})};return e.jsxs("div",{className:"flex h-full animate-fade-in overflow-hidden",style:{minWidth:"300px"},children:[e.jsx(zt,{isVisible:Y,message:o?"서사를 수정하고 분석 중입니다...":"AI가 서사를 분석하고 있습니다..."}),e.jsx(Tt,{isOpen:ie.isOpen,type:ie.type,title:ie.title,message:ie.message,defaultValue:ie.defaultValue,onConfirm:ie.onConfirm,onCancel:ne}),Ne&&e.jsx(Et,{character:Ne,isOpen:!!Ne,onClose:()=>ke(null),onSave:t=>{b(t),ke(null)},onDelete:t=>{A.deleteProfile(t),ke(null)}}),v&&!g&&e.jsx("button",{onClick:()=>w(!1),className:`${f?"":"lg:hidden"} fixed top-1/2 -translate-y-1/2 left-[-8px] z-[60] p-2 md:p-4 rounded-r-full bg-[var(--accent-primary)] text-[var(--accent-text)] shadow-2xl border border-[var(--accent-50)] animate-bounce-in transition-all hover:left-0`,children:e.jsx(la,{size:18})}),e.jsx(ja,{isSidebarCollapsed:v,setIsSidebarCollapsed:w,selectedCatId:c,setSelectedCatId:F,categories:h,visibleCategories:ut,ddays:E,onAddCategory:async t=>{const l=be(t);if(l){const r=[...h,{id:crypto.randomUUID(),name:l}];await A.saveNarrativeCategories(r),L(r)}},onRenameCategory:ft,onDeleteCategory:yt,onReorderCategories:async t=>{const r=[h.find(m=>m.id==="default")||{id:"default",name:"기본"},...t];L(r),await A.saveNarrativeCategories(r)},onAddDDay:async(t,l)=>{const r=be(t);if(r){const m=[...E,{id:crypto.randomUUID(),title:r,targetDate:l}];await A.saveDDays(m),await J()}},onDeleteDDay:async t=>{const l=E.filter(r=>r.id!==t);await A.saveDDays(l),await J()},onBackup:()=>A.createNarrativeBackup(),onRestore:async t=>{var m;const l=(m=t.target.files)==null?void 0:m[0];if(!l)return;const r=new FileReader;r.onload=async I=>{var O;try{const R=JSON.parse((O=I.target)==null?void 0:O.result);await A.restoreNarrativeBackup(R)?(await J(),ce("success","서사 복원 완료","서사 기록이 로드되었습니다.",ne)):ce("error","복원 실패","형식이 다릅니다.",ne)}catch{ce("error","로드 오류","파일 오류",ne)}},r.readAsText(l),t.target.value=""},getOffsetNow:ee,isAddingDDay:d,setIsAddingDDay:$,isMobileUI:f}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden relative",children:[e.jsx("header",{className:`sticky top-0 z-40 px-4 md:px-8 transition-all duration-500 ease-in-out
  ${dt?"py-3 md:py-6 border-b opacity-100 shadow-none lg:shadow-sm":"h-0 py-0 border-b-0 opacity-0"}`,style:{borderColor:"var(--glass-border)",backgroundColor:"var(--glass-bg)"},children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("div",{className:"flex items-center gap-4 z-10",children:e.jsxs("h1",{className:"text-sm md:text-lg font-black flex items-center gap-2 md:gap-3 truncate",style:{color:"var(--text-primary)"},children:[e.jsx($t,{size:18,className:"text-[var(--accent-primary)] shrink-0"}),e.jsx("span",{className:"hidden md:inline",children:c==="all"?"전체 기록":(Je=h.find(t=>t.id===c))==null?void 0:Je.name})]})}),e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 z-10 flex items-center gap-2",children:[e.jsx("div",{className:"flex glass-panel p-1 rounded-xl border overflow-x-auto no-scrollbar",style:{borderColor:"var(--glass-border)",backgroundColor:"rgba(0,0,0,0.1)"},children:[{id:"history",label:"서사 분석",icon:e.jsx(Ht,{size:14})},{id:"analysis",label:"캐릭터별 분석",icon:e.jsx(et,{size:14})},{id:"trends",label:"타임라인",icon:e.jsx(ta,{size:14})}].map(t=>e.jsxs("button",{onClick:()=>{q(t.id),pe(null)},className:`flex items-center gap-2 px-3 md:px-5 py-2 rounded-lg
              text-[9px] md:text-[10px] font-black transition-all whitespace-nowrap
              ${C===t.id?"shadow-md scale-[1.02]":"opacity-40 hover:opacity-100 hover:bg-white/5"}`,style:{backgroundColor:C===t.id?"var(--accent-primary)":"transparent",color:C===t.id?"var(--accent-text)":"var(--text-primary)"},children:[t.icon,e.jsx("span",{className:"hidden md:inline",children:t.label})]},t.id))}),c!=="all"&&C!=="analysis"&&e.jsx("button",{onClick:()=>$e(!ze),className:`p-2 translate-x-2 rounded-xl bg-white/5 border border-white/10 transition-all
          hover:bg-white/10`,style:{color:vt},title:"배경 설정",children:e.jsx(ra,{size:18})})]}),e.jsx("div",{className:"ml-auto flex items-center z-10"})]})}),e.jsxs("div",{ref:oe,className:`flex-1 ${C==="trends"?"overflow-hidden p-0":"overflow-y-auto p-4 md:p-8"} custom-scrollbar relative`,children:[C==="history"&&e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx(We,{type:"history"}),e.jsxs("div",{className:"flex flex-col gap-6 md:gap-10 w-full max-w-5xl mx-auto h-full relative z-10",children:[c!=="all"&&e.jsx("div",{className:"w-full",children:u?e.jsx(wa,{isInputFormOpen:u,setIsInputFormOpen:z,editingLogId:o,inputText:G,setInputText:P,inputDate:W,setInputDate:te,inputTime:Q,setInputTime:Z,selectedProfileIds:n,setSelectedProfileIds:x,availableCharacters:Ue,onSave:ht,isLoading:Y,onCancel:()=>{z(!1),i(null),P("")},textareaRef:Ce}):e.jsxs("button",{onClick:()=>{z(!0),setTimeout(()=>{var t;return(t=Ce.current)==null?void 0:t.focus()},100)},className:"w-full p-8 md:p-12 rounded-[2rem] md:rounded-[2.5rem] border-2 border-dashed border-white/10 hover:border-[var(--accent-primary)] hover:bg-[var(--accent-10)] transition-all flex flex-col items-center justify-center gap-4 group",children:[e.jsx("div",{className:"p-4 rounded-full bg-white/5 group-hover:scale-110 transition-transform",children:e.jsx(Me,{size:32,className:"text-[var(--accent-primary)]"})}),e.jsx("span",{className:"text-base md:text-lg font-black opacity-40 group-hover:opacity-100",style:{color:"var(--text-primary)"},children:"새로운 서사 기록하기"})]})}),e.jsxs("div",{className:"space-y-6 pb-20 mt-10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-4",children:[e.jsxs("div",{className:"flex items-center gap-3 opacity-30",children:[e.jsx("span",{className:"text-[12px] font-black uppercase tracking-[0.1em]",children:"기록된 서사"}),e.jsx("div",{className:"w-12 md:w-24 h-[1px] bg-white/20"})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1.5 bg-black/5 rounded-xl border border-white/5 shadow-none lg:shadow-inner",children:[e.jsx(it,{size:12,className:"opacity-40"}),e.jsxs("select",{value:U,onChange:t=>se(t.target.value),className:"bg-transparent text-[var(--text-primary)] border-none px-2 py-0.5 rounded-lg text-[10px] font-black outline-none cursor-pointer",children:[e.jsx("option",{value:"latest",className:"text-slate-900 bg-white",children:"날짜순"}),e.jsx("option",{value:"registration",className:"text-slate-900 bg-white",children:"등록순"})]})]})]}),de.length===0?e.jsx("div",{className:"py-20 text-center opacity-30 italic font-bold",style:{color:"var(--text-primary)"},children:"기록된 서사가 없습니다."}):de.map(t=>e.jsx(ka,{log:t,categories:h,savedCharacters:p,onEdit:gt,onDelete:bt,onChangeCategory:async(l,r)=>{const m=N.find(I=>I.id===l);m&&(await A.saveLog({...m,categoryId:r}),await J())},onCharacterClick:Ke},t.id))]})]})]}),C==="analysis"&&e.jsx(va,{logs:de,knownProfiles:Ue,onUpdateProfile:b,onNavigateToAnalysis:t=>{j(t)},focusTarget:M,currentCategoryId:c},c),C==="trends"&&e.jsxs("div",{className:"h-full w-full flex flex-col justify-center relative",children:[e.jsx(We,{type:"trends"}),e.jsx("div",{className:"flex-1 overflow-x-auto custom-scrollbar no-scrollbar relative z-10",ref:ot,children:c==="all"?e.jsxs("div",{className:"glass-panel p-12 rounded-[2.5rem] border bg-[var(--accent-primary)]/5 flex flex-col items-center justify-center gap-4 text-center max-w-2xl mx-auto relative z-10",style:{borderColor:"var(--glass-border)"},children:[e.jsx(ve,{size:48,className:"text-[var(--accent-primary)] opacity-40"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-xl font-black",style:{color:"var(--text-primary)"},children:"서사 카테고리를 선택하세요"}),e.jsx("p",{className:"text-sm opacity-50",style:{color:"var(--text-primary)"},children:"타임라인 분석은 개별 카테고리 화면에서만 가능합니다."})]})]}):e.jsxs("div",{className:"relative min-w-max flex items-center h-full",children:[e.jsx("div",{className:"absolute left-0 right-0 h-0.5 top-1/2 -translate-y-1/2 opacity-30",style:{background:"linear-gradient(to right, transparent, var(--accent-primary), transparent)"}}),e.jsx("div",{className:"flex items-center gap-48 relative px-32",children:pt.map((t,l)=>{var I;const r=typeof((I=t.analysis)==null?void 0:I.score)=="number"?t.analysis.score:50,m=r<=20?"#ef4444":r<=30?"#f97316":r<=40?"#eab308":r<=50?"#8b5cf6":r<=60?"#3b82f6":r<=70?"#2a78b8":r<=80?"#38bdf8":r<=90?"#1ba879":r<95?"#f472b6":"var(--accent-primary)";return e.jsxs("div",{className:"relative group cursor-pointer flex flex-col items-center",onClick:()=>S(t),children:[e.jsxs("div",{className:`absolute ${l%2===0?"top-[-35px]":"bottom-[-35px]"} text-[10px] font-black opacity-60 whitespace-nowrap bg-[var(--accent-10)] px-3 py-1 rounded-full border border-[var(--accent-20)] flex items-center gap-1.5`,style:{color:"var(--text-primary)"},children:[e.jsx(Ie,{size:10})," ",t.date]}),e.jsx("div",{className:"w-3 h-3 rounded-full border-1 shadow-2xl transition-all duration-300 group-hover:scale-150 z-10",style:{backgroundColor:m,borderColor:"var(--bg-from)"}}),e.jsx("div",{className:`absolute bottom-full mb-2 left-1/2 -translate-x-1/2 
                                                              hidden group-hover:block z-50`,children:e.jsxs("div",{className:"bg-gray-900 text-white text-xs py-1 px-2 rounded shadow-xl whitespace-nowrap",children:["관계점수 : ",r,"점",e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})}),e.jsx("div",{className:`absolute ${l%2===0?"bottom-[calc(50%+45px)]":"top-[calc(50%+45px)]"} flex flex-col items-center w-40 text-center space-y-4`,children:e.jsx("div",{className:"glass-panel p-5 rounded-[2rem] border bg-white/5 group-hover:border-[var(--accent-primary)] transition-all shadow-xl w-full hover:scale-105 duration-300",style:{borderColor:"var(--glass-border)"},children:e.jsxs("div",{className:"flex flex-wrap justify-center gap-1.5",children:[(t.characters||[]).map(O=>e.jsxs("span",{className:"px-2 py-0.5 rounded-lg text-[10px] font-black flex items-center gap-1",style:{backgroundColor:"var(--accent-primary)",color:"var(--accent-text)"},children:[e.jsx(Te,{size:8,fill:"currentColor"})," ",X(O.name).replace(/[\[\]]/g,"")]},O.name)),(!t.characters||t.characters.length===0)&&e.jsx("span",{className:"text-[10px] font-bold opacity-30",children:"등장인물 없음"})]})})})]},t.id)})})]})}),H&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-black/40 backdrop-blur-md animate-fade-in",onClick:()=>S(null),children:e.jsxs("div",{className:"relative w-full max-w-2xl glass-panel p-6 md:p-10 rounded-[2.5rem] md:rounded-[3.5rem] shadow-2xl border flex flex-col gap-8",style:{borderColor:"var(--glass-border)",backgroundColor:"var(--glass-bg)"},onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>S(null),className:"absolute top-6 right-6 md:top-8 md:right-8 p-3 rounded-full hover:bg-white/10 transition-colors",style:{color:"white"},children:e.jsx(me,{size:24})}),e.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 pb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-black text-[var(--accent-primary)] mb-2 uppercase tracking-widest",children:[H.date," ",H.time]}),e.jsx("h2",{className:"text-xl md:text-2xl font-black text-white",children:"서사 기록 상세"})]}),e.jsx("div",{className:"text-lg md:text-xl mt-5 mr-5 font-black text-amber-500 flex items-center gap-2 bg-transparent px-4 py-1 rounded-2xl",title:`서사점수 : ${X(((Ge=H.analysis)==null?void 0:Ge.score)||0)}점`,children:e.jsx(Te,{size:20,fill:"currentColor"})})]}),e.jsxs("div",{className:"space-y-8 overflow-y-auto custom-scrollbar pr-4 max-h-[55vh] text-white",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-[10px] font-black opacity-30 uppercase tracking-widest flex items-center gap-2"}),e.jsx("div",{className:"flex wrap gap-2",children:(H.characters||[]).map(t=>e.jsxs("button",{onClick:()=>{Ke(t.name,H.id)},className:"px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-xs font-black hover:bg-[var(--accent-20)] transition-all flex items-center gap-2",children:[e.jsx(et,{size:12,className:"text-[var(--accent-primary)]"})," ",X(t.name).replace(/[\[\]]/g,"")]},t.name))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"font-black opacity-30 uppercase tracking-widest flex items-center gap-2"}),e.jsx("p",{className:"text-base md:text-lg font-bold leading-relaxed",children:e.jsx(at,{text:X((Qe=H.analysis)==null?void 0:Qe.summary),label:"요약",icon:e.jsx(ct,{size:10}),colorClass:"text-[var(--accent-primary)]",labelSize:"text-[10px]",contentSize:"text-[15px]",showQuote:!0})})]}),((Ze=H.analysis)==null?void 0:Ze.keywords)&&e.jsx("div",{className:"flex wrap gap-2",children:H.analysis.keywords.map((t,l)=>e.jsxs("span",{className:"text-[11px] font-black text-[var(--accent-50)] hover:bg-[var(--accent-10)] px-2 py-1 rounded-lg border border-[var(--accent-40)]",children:["#",X(t)]},l))}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-[10px] font-black opacity-30 uppercase tracking-widest flex items-center gap-2"}),e.jsx("p",{className:"text-sm italic opacity-80 border-l-4 border-[var(--accent-30)] pl-6 py-2 leading-relaxed whitespace-pre-wrap",children:e.jsx(at,{text:X(H.content),label:"",icon:e.jsx(Le,{size:0}),colorClass:"text-[var(--text-primary)]",labelSize:"text-[10px]",contentSize:"text-[13px]",isItalic:!0})})]})]})]})})]})]}),ze&&e.jsx("div",{className:"fixed inset-0 z-[190]",onClick:()=>$e(!1)}),e.jsx(jt,{})]})]})};export{Ba as default};
